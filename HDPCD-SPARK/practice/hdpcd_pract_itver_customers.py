from pyspark import SparkContext, SparkConf

conf =  SparkConf().setMaster("local").setAppName("MyName")
sc =  SparkContext(conf=conf)

# find the customers who are from same city and having same last name

custRdd =  sc.textFile("/hdpcd/retail_db/customers/part-00000")
'''
custRddMap = custRdd.map(lambda cust: cust.split(","))

print custRddMap.first()
[u'1', u'Richard', u'Hernandez', u'XXXXXXXXX', u'XXXXXXXXX', u'6303 Heather Plaza', u'Brownsville', u'TX', u'78521']

'''

custLastNameSameCity =  custRdd.map( lambda cust: ((cust.split(",")[2], cust.split(",")[-2] ), (cust.split(",")[0], cust.split(",")[1])))
print custLastNameSameCity.first()
custLastNameSameCityMap =  custLastNameSameCity.reduceByKey(lambda result, entry: str(result)+",{0}".format(entry) )

for cust in custLastNameSameCityMap.take(10): print cust

'''
((u'Fitzgerald', u'IL'), (u'2744', u'Amanda'))
((u'Tate', u'PR'), "(u'1198', u'Beverly'),(u'3191', u'Kathleen'),(u'3318', u'Henry'),(u'3778', u'Robert'),(u'6109', u'Zachary'),(u'9632', u'Mary')")
((u'Vincent', u'MO'), (u'5222', u'Evelyn'))
((u'Richardson', u'TX'), "(u'7551', u'Robert'),(u'8215', u'David')")
((u'Wade', u'OH'), (u'8026', u'Mary'))
((u'Mullins', u'GA'), (u'8581', u'Mary'))
((u'Walker', u'CA'), "(u'1524', u'Nathan'),(u'3699', u'Charles'),(u'8537', u'Wayne'),(u'10685', u'Amy'),(u'11567', u'Mary'),(u'11590', u'Mark'),(u'12248', u'Mary')")
((u'Jenkins', u'PR'), "(u'2672', u'Kathryn'),(u'7449', u'Jerry'),(u'8302', u'Mary'),(u'8908', u'Mary'),(u'9153', u'Sharon'),(u'9953', u'Mary')")
((u'Brown', u'PA'), "(u'1517', u'James'),(u'1712', u'Megan'),(u'9031', u'Mary')")

'''




# No of customers having same last name in each city
'''custCityMap =  custRdd.map(lambda cust: ((cust.split(",")[-2], cust.split(",")[2]),1))

custCityMapResult = custCityMap.reduceByKey(lambda x,y:x+y)

for custCity in custCityMapResult.collect(): print custCity
'''
'''
((u'FL', u'Ramirez'), 1)
((u'OR', u'Huynh'), 1)
((u'CT', u'Warner'), 1)
((u'PR', u'Carlson'), 5)
((u'IN', u'Harvey'), 1)
((u'PA', u'Hubbard'), 1)
((u'PR', u'Caldwell'), 5)
((u'PR', u'Herman'), 1)
((u'PR', u'Nolan'), 2)
((u'CA', u'Collier'), 1)
((u'WA', u'Harvey'), 1)
((u'KS', u'Nguyen'), 1)
((u'IL', u'Shah'), 1)
((u'VA', u'Stanley'), 1)
((u'NY', u'Orozco'), 1)
((u'MI', u'Griffin'), 1)
((u'VA', u'Vincent'), 1)
((u'IL', u'Lam'), 1)
((u'IL', u'Petersen'), 1)
((u'VA', u'Stevens'), 1)
((u'NC', u'Walker'), 1)
((u'PR', u'Mcgrath'), 3)
((u'CA', u'Ramirez'), 2)
((u'PR', u'Garza'), 5)
((u'CA', u'Arroyo'), 1)
((u'PA', u'Romero'), 1)
((u'IL', u'Dunn'), 1)
((u'TN', u'Hayes'), 1)
((u'TX', u'Rice'), 1)
((u'GA', u'Camacho'), 1)
((u'MD', u'Holt'), 1)
((u'PA', u'Frost'), 1)
((u'CA', u'Cannon'), 1)
((u'OR', u'Delgado'), 1)
((u'CA', u'Mann'), 1)
((u'UT', u'Reed'), 1)
((u'PR', u'Webster'), 4)
((u'CA', u'Wolfe'), 1)
((u'TX', u'Sanders'), 2)
((u'NV', u'Gardner'), 1)
((u'MD', u'Cooper'), 1)
((u'TX', u'Decker'), 1)
((u'FL', u'Shields'), 1)
((u'DC', u'Banks'), 1)
((u'CA', u'Mcdowell'), 1)
((u'CA', u'Bradley'), 2)
((u'PA', u'Shaffer'), 1)
((u'WA', u'Valenzuela'), 1)
((u'CA', u'Jarvis'), 1)
((u'CA', u'Salinas'), 1)
((u'MI', u'James'), 1)
((u'CA', u'Rhodes'), 1)
((u'PR', u'Foley'), 1)
((u'FL', u'Andrade'), 1)
((u'TN', u'Washington'), 1)
((u'AZ', u'Dixon'), 1)
((u'PR', u'Dunlap'), 2)
((u'NC', u'Thomas'), 1)
((u'OR', u'Bond'), 1)
((u'PR', u'Pratt'), 3)
((u'NY', u'Butler'), 1)
((u'OR', u'Henry'), 1)
((u'PR', u'Hamilton'), 3)
((u'MN', u'Fletcher'), 1)
((u'PR', u'Rhodes'), 3)
((u'PR', u'Best'), 2)
((u'NC', u'Anderson'), 1)
((u'PA', u'Dominguez'), 1)
((u'CA', u'Davenport'), 1)
((u'IL', u'Whitney'), 1)
((u'NY', u'Bright'), 1)
((u'PR', u'Rich'), 2)
((u'MD', u'Long'), 1)
((u'IL', u'Peterson'), 1)
((u'OH', u'Zamora'), 1)
((u'OK', u'Adams'), 1)
((u'NC', u'Pierce'), 1)
((u'NY', u'Wheeler'), 2)
((u'CA', u'Howell'), 3)
((u'HI', u'Arnold'), 1)
((u'FL', u'Lopez'), 1)
((u'CA', u'Leon'), 1)
((u'MD', u'Randolph'), 1)
((u'TX', u'Key'), 1)
((u'NV', u'Warren'), 1)
((u'PR', u'Pearson'), 1)
((u'TX', u'Patel'), 2)
((u'CO', u'Wiggins'), 1)
((u'CT', u'Hendricks'), 1)
((u'OH', u'Brennan'), 1)
((u'LA', u'Booker'), 1)
((u'CA', u'Jones'), 12)
((u'CA', u'Villa'), 1)
((u'OH', u'Peters'), 2)
((u'PR', u'Joseph'), 1)
((u'PR', u'Marquez'), 3)
((u'VA', u'Sheppard'), 1)
((u'PR', u'Huff'), 2)
((u'PA', u'Williamson'), 1)
((u'DE', u'Mcfarland'), 1)
((u'CA', u'Carrillo'), 1)
((u'NY', u'Kelly'), 1)
((u'NY', u'Moss'), 1)
((u'DC', u'Greene'), 1)
((u'FL', u'Holmes'), 1)
((u'PR', u'Gilbert'), 4)
((u'OH', u'Murphy'), 1)
((u'PR', u'May'), 2)
((u'FL', u'Macias'), 1)
((u'SC', u'Glenn'), 1)
((u'CA', u'Wheeler'), 1)
((u'LA', u'Smith'), 24)
((u'IL', u'Oliver'), 1)
((u'PR', u'Flores'), 11)
((u'TX', u'Bowers'), 1)
((u'MA', u'Martinez'), 1)
((u'AZ', u'Landry'), 1)
((u'MA', u'Adkins'), 1)
((u'CT', u'Mayer'), 1)
((u'OH', u'Reid'), 1)
((u'TX', u'Butler'), 1)
((u'PR', u'Stafford'), 5)
((u'IA', u'Smith'), 3)
((u'NJ', u'Sellers'), 1)
((u'CA', u'Whitaker'), 1)
((u'OH', u'Rodriguez'), 1)
((u'PR', u'Kemp'), 4)
((u'NY', u'Mason'), 1)
((u'CA', u'Solis'), 1)
((u'TX', u'Dean'), 1)
((u'CA', u'Moyer'), 2)
((u'CA', u'Blankenship'), 1)
((u'CA', u'Erickson'), 1)
((u'NY', u'Frazier'), 2)
((u'NJ', u'Sandoval'), 1)
((u'PR', u'Woodard'), 2)
((u'TX', u'Keith'), 1)
((u'MI', u'Adkins'), 1)
((u'MI', u'Allen'), 2)
((u'CO', u'Rice'), 1)
((u'PR', u'Haley'), 1)
((u'AZ', u'Payne'), 1)
((u'FL', u'Rangel'), 1)
((u'MN', u'Alvarado'), 1)
((u'VA', u'Knapp'), 1)
((u'MT', u'Smith'), 2)
((u'DC', u'Clark'), 1)
((u'NY', u'Roberts'), 4)
((u'PA', u'Werner'), 1)
((u'CO', u'Massey'), 1)
((u'CA', u'Sparks'), 1)
((u'PR', u'Hansen'), 3)
((u'CA', u'Olson'), 2)
((u'TN', u'Holloway'), 1)
((u'TX', u'Day'), 1)
((u'PR', u'Eaton'), 1)
((u'PA', u'Padilla'), 1)
((u'PR', u'Mercado'), 2)
((u'PR', u'Giles'), 1)
((u'WV', u'Hickman'), 1)
((u'FL', u'Velasquez'), 1)
((u'MO', u'White'), 1)
((u'NV', u'Cunningham'), 1)
((u'CA', u'Good'), 1)
((u'PR', u'Harris'), 9)
((u'OH', u'Pugh'), 1)
((u'CA', u'Carr'), 2)
((u'TX', u'Bentley'), 1)
((u'FL', u'Powell'), 1)
((u'OH', u'Owens'), 2)
((u'NV', u'Blake'), 1)
((u'PR', u'Holloway'), 4)
((u'IL', u'Townsend'), 1)
((u'OH', u'Powers'), 1)
((u'WA', u'Hawkins'), 1)
((u'VA', u'Gonzales'), 1)
((u'OH', u'Bennett'), 1)
((u'PR', u'Howell'), 1)
((u'MA', u'Mckee'), 1)
((u'PA', u'Proctor'), 1)
((u'PR', u'Graham'), 4)
((u'CA', u'Harmon'), 1)
((u'PR', u'Rivas'), 2)
((u'MI', u'Wright'), 1)
((u'TX', u'Contreras'), 1)
((u'MI', u'Stokes'), 1)
((u'CA', u'Merritt'), 3)
((u'OR', u'Carr'), 1)
((u'NY', u'Herring'), 1)
((u'NY', u'Fitzpatrick'), 1)
((u'IN', u'Hutchinson'), 1)
((u'CA', u'Acosta'), 1)
((u'WI', u'Mckinney'), 1)
((u'TX', u'Barrett'), 1)
((u'UT', u'Reynolds'), 1)
((u'GA', u'Arnold'), 1)
((u'CA', u'Horne'), 1)
((u'PR', u'Harding'), 1)
((u'TX', u'Silva'), 1)
((u'CA', u'Diaz'), 1)
((u'AZ', u'Pruitt'), 1)
((u'CA', u'Koch'), 2)
((u'MO', u'Carrillo'), 1)
((u'NM', u'Taylor'), 1)
((u'PR', u'Clarke'), 1)
((u'TX', u'Vega'), 1)
((u'PR', u'Gamble'), 2)
((u'NV', u'Wilson'), 1)
((u'TN', u'Brady'), 1)
((u'FL', u'Whitaker'), 1)
((u'MI', u'Kirk'), 1)
((u'FL', u'Todd'), 1)
((u'WA', u'Preston'), 1)
((u'MD', u'Merritt'), 1)
((u'PR', u'Chan'), 2)
((u'CA', u'Banks'), 3)
((u'TX', u'Reyes'), 1)
((u'CA', u'Wilkins'), 1)
((u'CA', u'Gomez'), 4)
((u'PR', u'Graves'), 2)
((u'PR', u'Ballard'), 1)
((u'MD', u'Kane'), 1)
((u'IL', u'Carey'), 1)
((u'NY', u'Miller'), 1)
((u'MI', u'Walker'), 1)
((u'MA', u'Tate'), 1)
((u'TX', u'Powers'), 1)
((u'CA', u'Murphy'), 4)
((u'PR', u'Cook'), 8)
((u'NY', u'Walker'), 4)
((u'PR', u'Hanna'), 2)
((u'SC', u'Hayden'), 1)
((u'TX', u'Acevedo'), 1)
((u'PR', u'Mcbride'), 4)
((u'CA', u'Ward'), 1)
((u'NC', u'Mahoney'), 1)
((u'OH', u'Nguyen'), 1)
((u'OR', u'Conrad'), 1)
((u'WI', u'Martin'), 1)
((u'TX', u'Sheppard'), 1)
((u'LA', u'Ortiz'), 1)
((u'CA', u'Horton'), 1)
((u'MO', u'Weber'), 1)
((u'CO', u'Smith'), 44)
((u'PR', u'Serrano'), 5)
((u'OH', u'Gates'), 1)
((u'VA', u'Padilla'), 1)
((u'SC', u'Chung'), 1)
((u'PR', u'Dalton'), 1)
((u'NJ', u'Reed'), 1)
((u'WA', u'Castillo'), 1)
((u'OR', u'Berry'), 1)
((u'CA', u'Castillo'), 3)
((u'NY', u'Castillo'), 1)
((u'PA', u'James'), 1)
((u'PR', u'Gallegos'), 4)
((u'OR', u'Davis'), 1)
((u'CA', u'Dillon'), 1)
((u'NY', u'Delgado'), 1)
((u'PA', u'Molina'), 1)
((u'GA', u'Douglas'), 1)
((u'TX', u'Ortiz'), 1)
((u'OH', u'Lopez'), 2)
((u'CO', u'Cox'), 2)
((u'FL', u'Murphy'), 1)
((u'TX', u'Jefferson'), 1)
((u'PR', u'Long'), 5)
((u'NJ', u'Watkins'), 1)
((u'NM', u'Byrd'), 1)
((u'NY', u'Escobar'), 1)
((u'PR', u'Adkins'), 2)
((u'PR', u'Carter'), 7)
((u'MN', u'Trujillo'), 1)
((u'CA', u'Smith'), 713)
((u'DE', u'Mack'), 1)
((u'NY', u'Hansen'), 1)
((u'PR', u'Goodwin'), 1)
((u'PR', u'Lynn'), 2)
((u'FL', u'Lawson'), 1)
((u'GA', u'Thomas'), 1)
((u'CA', u'Adkins'), 1)
((u'PR', u'Robinson'), 9)
((u'MI', u'Rhodes'), 1)
((u'CA', u'Lindsey'), 2)
((u'PR', u'Archer'), 2)
((u'PR', u'Conley'), 2)
((u'PA', u'Lyons'), 1)
((u'PA', u'Stewart'), 1)
((u'UT', u'Crane'), 1)
((u'CT', u'Moss'), 1)
((u'TX', u'Donovan'), 1)
((u'TX', u'Higgins'), 1)
((u'NV', u'Branch'), 1)
((u'MD', u'Jacobs'), 1)
((u'TX', u'Gutierrez'), 1)
((u'PR', u'Hurst'), 2)
((u'CA', u'Tate'), 1)
((u'TX', u'James'), 2)
((u'TX', u'Norton'), 1)
((u'TX', u'Griffith'), 1)
((u'PR', u'Baker'), 10)
((u'TX', u'Sellers'), 1)
((u'NJ', u'Arroyo'), 1)
((u'OH', u'Norris'), 1)
((u'CA', u'Mendez'), 1)
((u'FL', u'Chavez'), 1)
((u'AZ', u'Thornton'), 1)
((u'TX', u'West'), 1)
((u'PR', u'Coleman'), 6)
((u'PR', u'Tanner'), 2)
((u'WV', u'Smith'), 7)
((u'OR', u'Parker'), 1)
((u'MT', u'Roach'), 1)
((u'OH', u'Shelton'), 1)
((u'TX', u'Gilbert'), 1)
((u'NY', u'Sosa'), 1)
((u'GA', u'Castillo'), 1)
((u'IL', u'Allen'), 2)
((u'OR', u'Meyer'), 1)
((u'NY', u'Ortiz'), 2)
((u'MD', u'Richardson'), 1)
((u'FL', u'Finley'), 1)
((u'PR', u'Patterson'), 4)
((u'CA', u'Mcdonald'), 2)
((u'NV', u'Harrison'), 1)
((u'NY', u'Crawford'), 1)
((u'NY', u'Humphrey'), 1)
((u'OR', u'Smith'), 33)
((u'MI', u'Benton'), 1)
((u'NY', u'Martin'), 1)
((u'MO', u'Reeves'), 1)
((u'DC', u'Pierce'), 1)
((u'MD', u'Blair'), 1)
((u'TN', u'Snow'), 1)
((u'TX', u'Hardin'), 1)
((u'TN', u'Casey'), 1)
((u'PR', u'White'), 8)
((u'CA', u'Alexander'), 5)
((u'TX', u'Kidd'), 1)
((u'OH', u'Harris'), 2)
((u'CA', u'Hendrix'), 1)
((u'MA', u'Carr'), 1)
((u'PR', u'Roman'), 4)
((u'NY', u'Alvarez'), 2)
((u'NV', u'Munoz'), 1)
((u'PR', u'Joyce'), 4)
((u'TX', u'Olsen'), 1)
((u'NC', u'Garner'), 2)
((u'MD', u'Griffith'), 1)
((u'PR', u'Davis'), 21)
((u'TX', u'Gallagher'), 1)
((u'PR', u'Stephenson'), 3)
((u'MO', u'Evans'), 1)
((u'IL', u'Padilla'), 2)
((u'OR', u'Garcia'), 2)
((u'PR', u'Dominguez'), 5)
((u'PR', u'Armstrong'), 2)
((u'PR', u'Parsons'), 3)
((u'CA', u'Davis'), 9)
((u'WA', u'Smith'), 21)
((u'PR', u'Waters'), 1)
((u'PR', u'Bond'), 2)
((u'RI', u'Simon'), 1)
((u'MA', u'Dixon'), 1)
((u'PA', u'Owens'), 1)
((u'MA', u'Gillespie'), 1)
((u'CT', u'Sweeney'), 1)
((u'UT', u'Bentley'), 1)
((u'FL', u'Schwartz'), 1)
((u'IL', u'Michael'), 2)
((u'PR', u'Hartman'), 7)
((u'FL', u'Gillespie'), 1)
((u'TX', u'Benitez'), 1)
((u'PA', u'Murray'), 1)
((u'IL', u'Choi'), 1)
((u'OR', u'West'), 1)
((u'MA', u'Burton'), 1)
((u'MI', u'Lambert'), 1)
((u'NY', u'Booker'), 1)
((u'NC', u'Daniel'), 1)
((u'TX', u'Lowe'), 1)
((u'TX', u'Jacobs'), 1)
((u'MA', u'Jimenez'), 1)
((u'VA', u'Acosta'), 1)
((u'PR', u'Leon'), 1)
((u'CA', u'Wolf'), 1)
((u'NY', u'Sanders'), 1)
((u'MA', u'Pierce'), 1)
((u'PR', u'Frazier'), 3)
((u'CA', u'Montgomery'), 2)
((u'MI', u'Harrell'), 1)
((u'NJ', u'Steele'), 1)
((u'PR', u'Cruz'), 2)
((u'TX', u'Curtis'), 1)
((u'CO', u'Cooper'), 1)
((u'PR', u'Fry'), 1)
((u'PA', u'Schwartz'), 1)
((u'CA', u'Ayala'), 4)
((u'AZ', u'Neal'), 1)
((u'VA', u'Kaufman'), 1)
((u'NY', u'Burnett'), 2)
((u'CA', u'Key'), 1)
((u'PA', u'Wilson'), 1)
((u'CA', u'Patton'), 2)
((u'SC', u'Richardson'), 2)
((u'CA', u'Bailey'), 5)
((u'CA', u'Reese'), 1)
((u'KS', u'Riddle'), 1)
((u'CA', u'Flowers'), 1)
((u'PR', u'Cohen'), 3)
((u'NY', u'Hodge'), 2)
((u'PR', u'Erickson'), 2)
((u'CA', u'Mata'), 1)
((u'AZ', u'Jackson'), 1)
((u'MN', u'Richardson'), 1)
((u'IL', u'Anderson'), 3)
((u'PR', u'Taylor'), 12)
((u'PA', u'Davidson'), 1)
((u'FL', u'Dickerson'), 1)
((u'NC', u'Simpson'), 1)
((u'OH', u'Weeks'), 1)
((u'PR', u'Lester'), 1)
((u'WA', u'Huffman'), 1)
((u'GA', u'Kim'), 1)
((u'LA', u'Campbell'), 1)
((u'PR', u'Pham'), 4)
((u'NY', u'Cline'), 2)
((u'MD', u'Hayes'), 1)
((u'PR', u'Manning'), 1)
((u'PA', u'Burgess'), 1)
((u'PR', u'Hodges'), 2)
((u'NC', u'Wheeler'), 1)
((u'IN', u'Johnson'), 1)
((u'OH', u'Knight'), 1)
((u'MA', u'Noble'), 1)
((u'OH', u'Rush'), 2)
((u'CA', u'Figueroa'), 1)
((u'NY', u'Sandoval'), 2)
((u'CA', u'Shannon'), 2)
((u'PR', u'Conner'), 3)
((u'MA', u'Clarke'), 1)
((u'PR', u'Hughes'), 5)
((u'FL', u'Macdonald'), 1)
((u'FL', u'Garrett'), 1)
((u'PR', u'Leblanc'), 4)
((u'MN', u'Reeves'), 1)
((u'NC', u'Gibbs'), 1)
((u'TX', u'Santana'), 1)
((u'IN', u'Robbins'), 1)
((u'FL', u'Lyons'), 3)
((u'UT', u'Williams'), 2)
((u'PA', u'Simon'), 1)
((u'IL', u'Pollard'), 1)


'''

